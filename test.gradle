// configure junit5 and spek2 engine
test {
    useJUnitPlatform {
        includeEngines('spek2')
    }

    // Always run tests, even when nothing changed.
    dependsOn 'cleanTest'
}

// configure pretty print of test result to std out
// for every task that is run as test task
tasks.withType(Test) {
    testLogging {
        events 'passed', 'skipped', 'failed'
        exceptionFormat "full"

        afterSuite { desc, r ->
            if (!desc.parent) { // will match the outermost suite
                def output = "${r.resultType} (${r.testCount} tests, ${r.successfulTestCount} successes, ${r.failedTestCount} failures, ${r.skippedTestCount} skipped)"
                def startItem = '| ', endItem = ' |'
                def repeatLength = startItem.length() + output.length() + endItem.length()
                println('\n' + ('-' * repeatLength) + '\n' + startItem + output + endItem + '\n' + ('-' * repeatLength))
            }
        }
    }
}
